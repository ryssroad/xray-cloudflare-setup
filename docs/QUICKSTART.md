# Quick Start Guide - Xray + Cloudflare

–ë—ã—Å—Ç—Ä–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Xray —Å Cloudflare –∑–∞ 15 –º–∏–Ω—É—Ç.

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ‚úÖ VPS —Å–µ—Ä–≤–µ—Ä —Å Ubuntu 22.04+ (–ª—é–±–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä)
- ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ–º–µ–Ω
- ‚úÖ –ê–∫–∫–∞—É–Ω—Ç Cloudflare (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
- ‚úÖ SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É —Å –ø—Ä–∞–≤–∞–º–∏ root

---

## –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–º–µ–Ω–∞ (5 –º–∏–Ω—É—Ç)

### 1.1 –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤ Cloudflare
1. –í–æ–π–¥–∏—Ç–µ –≤ https://dash.cloudflare.com/
2. –ù–∞–∂–º–∏—Ç–µ **"Add a Site"**
3. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `example.com`)
4. –í—ã–±–µ—Ä–∏—Ç–µ **Free Plan**

### 1.2 –ò–∑–º–µ–Ω–∏—Ç–µ nameservers
1. Cloudflare –ø–æ–∫–∞–∂–µ—Ç –¥–≤–∞ nameserver –∞–¥—Ä–µ—Å–∞
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–Ω–µ–ª—å –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–æ–º–µ–Ω–∞
3. –ó–∞–º–µ–Ω–∏—Ç–µ nameservers –Ω–∞ —Ç–µ, —á—Ç–æ —É–∫–∞–∑–∞–ª Cloudflare
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (–æ–±—ã—á–Ω–æ 5-30 –º–∏–Ω—É—Ç)

---

## –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (5 –º–∏–Ω—É—Ç)

### 2.1 –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
```bash
ssh root@YOUR_SERVER_IP
```

### 2.2 Xray —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
–í—ã —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ Xray, –ø—Ä–æ–≤–µ—Ä–∏–º:
```bash
xray version
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: Xray 25.10.15
```

### 2.3 –ó–∞–ø—É—Å—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
```bash
cd /root/xray-cloudflare-setup
./scripts/setup-server.sh
```

### 2.4 –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —Å–∫—Ä–∏–ø—Ç–∞

**–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:**
```
–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è Xray:
1) gRPC (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Cloudflare)
2) WebSocket
3) HTTP/2
–í–∞—à –≤—ã–±–æ—Ä [1-3]: 1
```
> –í—ã–±–µ—Ä–∏—Ç–µ **1** (gRPC)

**–î–æ–º–µ–Ω:**
```
–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω: api.example.com
```
> –í–≤–µ–¥–∏—Ç–µ —Å—É–±–¥–æ–º–µ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, `api.yourdomain.com`)

**TLS –º–µ—Ç–æ–¥:**
```
–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:
1) Caddy (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
2) Certbot (–≤—Ä—É—á–Ω—É—é)
3) –£ –º–µ–Ω—è —É–∂–µ –µ—Å—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
–í–∞—à –≤—ã–±–æ—Ä [1-3]: 1
```
> –í—ã–±–µ—Ä–∏—Ç–µ **1** (Caddy - –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ)

### 2.5 –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–∏—Ç firewall
- –ü–æ–ª—É—á–∏—Ç TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- –ó–∞–ø—É—Å—Ç–∏—Ç Xray

---

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare (5 –º–∏–Ω—É—Ç)

### 3.1 –°–æ–∑–¥–∞–π—Ç–µ DNS –∑–∞–ø–∏—Å—å
1. –í Cloudflare Dashboard –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **DNS** ‚Üí **Records**
3. –ù–∞–∂–º–∏—Ç–µ **Add record**
4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Type**: `A`
   - **Name**: `api` (–∏–ª–∏ —Ç–æ—Ç —Å—É–±–¥–æ–º–µ–Ω, —á—Ç–æ –≤—ã —É–∫–∞–∑–∞–ª–∏)
   - **IPv4 address**: `–í–ê–®_IP_–°–ï–†–í–ï–†–ê`
   - **Proxy status**: ‚òÅÔ∏è **Proxied** (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ!)
   - **TTL**: `Auto`
5. –ù–∞–∂–º–∏—Ç–µ **Save**

### 3.2 –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL/TLS
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SSL/TLS** ‚Üí **Overview**
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º: **Full (strict)** ‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!

### 3.3 –í–∫–ª—é—á–∏—Ç–µ gRPC –∏ WebSockets
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Network**
2. –í–∫–ª—é—á–∏—Ç–µ **gRPC**: `On` ‚úÖ
3. –í–∫–ª—é—á–∏—Ç–µ **WebSockets**: `On` ‚úÖ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ **HTTP/2**: `On` ‚úÖ

---

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ (2 –º–∏–Ω—É—Ç—ã)

### 4.1 –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS
```bash
dig +short api.yourdomain.com
```
–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å IP Cloudflare (–Ω–∞–ø—Ä–∏–º–µ—Ä, `104.21.xxx.xxx`), –∞ –ù–ï –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π IP!

### 4.2 –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
```bash
./scripts/troubleshoot.sh
```

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–µ–ª—ë–Ω—ã–µ ‚úÖ

---

## –®–∞–≥ 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (1 –º–∏–Ω—É—Ç–∞)

### 5.1 –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
./scripts/generate-client-config.sh
```

### 5.2 –°–∫–∞—á–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:
scp root@YOUR_SERVER_IP:/root/xray-client-configs/client-grpc-*.json ./
```

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
```bash
cat /root/xray-client-configs/client-grpc-*.json
```

---

## –®–∞–≥ 6: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞

### Desktop (Windows/Mac/Linux)

1. –°–∫–∞—á–∞–π—Ç–µ Xray-core:
   - Windows: https://github.com/XTLS/Xray-core/releases/latest
   - Mac/Linux: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ package manager

2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–∞–∫ `config.json`

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
xray -config config.json
```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏:
   - SOCKS5: `127.0.0.1:1080`
   - HTTP: `127.0.0.1:1081`

### Mobile (Android)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **v2rayNG** –∏–∑ Google Play
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ share link –∏–∑:
```bash
cat /root/xray-client-configs/share-link-grpc.txt
```
3. –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –∫–æ–¥ –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É

### Mobile (iOS)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **Shadowrocket** –∏–∑ App Store
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ share link –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

---

## –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (1 –º–∏–Ω—É—Ç–∞)

```bash
./scripts/setup-monitoring.sh
```

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±—É–¥–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –°–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥—ã–π —á–∞—Å
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç—ã –∫–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–í –±—Ä–∞—É–∑–µ—Ä–µ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –ø—Ä–æ–∫—Å–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ:
```
https://www.google.com
https://ifconfig.me
```

–î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å IP Cloudflare –∏–ª–∏ –≤–∞—à —Å–µ—Ä–≤–µ—Ä (–Ω–µ –≤–∞—à –¥–æ–º–∞—à–Ω–∏–π IP).

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏
```bash
# –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —Å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º –ø—Ä–æ–∫—Å–∏
curl -x socks5://127.0.0.1:1080 -o /dev/null -w "Speed: %{speed_download} bytes/sec\n" http://speedtest.tele2.net/100MB.zip
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS
```bash
dig +short api.yourdomain.com
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å IP Cloudflare (104.xxx –∏–ª–∏ 172.xxx)
```

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
./monitoring/generate-report.sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f /var/log/xray-monitor.log
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
```bash
systemctl status xray
journalctl -u xray -f
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
–ï—Å–ª–∏ gRPC —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ:
```bash
./scripts/switch-transport.sh
# –í—ã–±–µ—Ä–∏—Ç–µ WebSocket –∏–ª–∏ HTTP/2
```

---

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "Connection refused"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `systemctl status xray`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: `ufw status`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `./scripts/troubleshoot.sh`

### "TLS handshake failed"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL mode –≤ Cloudflare: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **Full (strict)**
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã: `ls -l /var/lib/caddy/.local/share/caddy/certificates/`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Caddy: `systemctl restart caddy`

### "Domain not resolving"
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS: `dig +short api.yourdomain.com`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Proxy status: **Proxied** (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ)
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è DNS (–¥–æ 24 —á–∞—Å–æ–≤)

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å Xray
systemctl status xray

# –†–µ—Å—Ç–∞—Ä—Ç Xray
systemctl restart xray

# –õ–æ–≥–∏ Xray
journalctl -u xray -f

# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
./scripts/troubleshoot.sh

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
./monitoring/generate-report.sh

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cat /root/xray-config-info.txt
```

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω–∞
2. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ uptime –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
3. ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è >60 –¥–Ω–µ–π –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
4. ‚úÖ –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏

---

## –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

- üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [README.md](../README.md)
- üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Cloudflare: [cloudflare-setup.md](cloudflare-setup.md)
- üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: `./scripts/troubleshoot.sh`
- üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: [xray-tz.md](../../xray-tz.md)

---

**–í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏:** ~15 –º–∏–Ω—É—Ç
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –õ—ë–≥–∫–∞—è
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–∞–±–æ—Ç–∞—é—â–∏–π Xray —Å Cloudflare CDN
